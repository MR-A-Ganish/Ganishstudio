<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thambulam Bags — Ganish Studio</title>
  <meta name="description" content="Traditional thambulam bags — Ganish Studio" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#050505;
      --accent:#fdbA01;
      --muted:#bfb6a1;
      --card-radius:12px;
      --glass: rgba(255,255,255,0.03);
      font-family:'Poppins',system-ui,Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#030303,#0b0b0c);
      color:var(--accent);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* ---------- Animated background (same as album) ---------- */
    .bg-layer{ position:fixed; inset:0; z-index:-2; pointer-events:none; overflow:hidden; }
    .orb { position:absolute; border-radius:50%; filter: blur(46px); opacity:0.28; transform: translate3d(0,0,0); mix-blend-mode: screen; animation: float linear infinite; will-change: transform; }
    .orb.o1{ width:720px; height:720px; left:-12%; top:-18%; background: radial-gradient(circle at 30% 30%, rgba(253,186,1,0.48), rgba(255,138,0,0.06)); animation-duration:36s;}
    .orb.o2{ width:520px; height:520px; right:-8%; top:18%; background: radial-gradient(circle at 60% 60%, rgba(142,68,173,0.28), rgba(30,136,229,0.05)); animation-duration:44s;}
    @keyframes float { 0%{ transform: translateY(0) } 50%{ transform: translateY(36px) } 100%{ transform: translateY(0) } }
    .pattern { position:absolute; inset:-10% -10% -10% -10%; background-image: radial-gradient(rgba(255,255,255,0.01) 1px, transparent 1px); background-size:24px 24px; opacity:0.06; mix-blend-mode:overlay; transform: translateZ(0); animation: drift 40s linear infinite; }
    @keyframes drift { from { transform: translateY(0) } to { transform: translateY(-120px) } }
    .bokeh { position:absolute; border-radius:50%; background:rgba(255,255,255,0.04); filter:blur(12px); opacity:0.14; transform:translate3d(0,0,0); }

    /* header */
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:rgba(0,0,0,0.36);backdrop-filter:blur(6px);position:sticky;top:0;z-index:40;border-bottom:1px solid rgba(255,200,0,0.04)}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:62px;height:62px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,200,0,0.06)}
    .brand h1{margin:0;font-size:18px}
    .brand .sub{font-size:12px;color:var(--muted)}

    /* toolbar */
    .toolbar{max-width:1200px;margin:18px auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .filters{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .filter-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent);cursor:pointer;font-weight:600;transition:transform .12s ease, background .12s ease}
    .filter-btn.active{background:var(--accent);color:#000;transform:translateY(-3px)}
    .controls{display:flex;gap:8px;align-items:center}

    .search{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent);min-width:220px}
    .select{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent)}

    /* grid & cards */
    .grid{max-width:1200px;margin:12px auto;padding:0 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;align-items:start}
    .album-card{background:rgba(255,255,255,0.02);border-radius:var(--card-radius);overflow:hidden;border:1px solid rgba(255,200,0,0.04);box-shadow:0 8px 30px rgba(0,0,0,0.6);transition:transform .22s, box-shadow .22s; transform-style:preserve-3d; will-change:transform; position:relative;}
    .album-card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 30px 90px rgba(0,0,0,0.85)}
    .album-thumb{width:100%;height:220px;object-fit:cover;display:block;position:relative}
    .album-meta{padding:12px;color:var(--muted)}
    .meta-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent);cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px}

    /* shine sweep */
    .shine { position:absolute; left:-60%; top:0; width:40%; height:100%; background:linear-gradient(120deg, rgba(255,255,255,0.0), rgba(255,255,255,0.14), rgba(255,255,255,0.0)); transform: skewX(-22deg) translateX(-10%); transition:transform .72s cubic-bezier(.2,.9,.2,1), opacity .6s ease; opacity:0; pointer-events:none; mix-blend-mode:screen; }
    .album-card:hover .shine{ transform: translateX(220%); opacity:0.9; }

    /* panel */
    .panel-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:80; display:none; align-items:center; justify-content:flex-end; }
    .panel-backdrop.open { display:flex; }
    .filter-panel { width:360px; max-width:100%; height:100%; background:linear-gradient(180deg, rgba(11,11,11,0.96), rgba(6,6,6,0.96)); backdrop-filter: blur(6px); padding:20px; box-shadow: -20px 0 60px rgba(0,0,0,0.6); transform: translateX(100%); transition: transform .26s cubic-bezier(.2,.9,.2,1); border-left:1px solid rgba(255,200,0,0.04); overflow:auto; }
    .panel-backdrop.open .filter-panel { transform: translateX(0); }
    .panel-close { display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,200,0,0.06); color:var(--accent); cursor:pointer; }

    .chips { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .chip { padding:8px 12px; border-radius:999px; background:transparent; border:1px solid rgba(255,200,0,0.06); color:var(--accent); font-weight:600; cursor:pointer; transition:transform .12s ease, background .12s ease; }
    .chip.active { background: linear-gradient(90deg, var(--accent), #ffd46a); color:#000; transform: translateY(-4px); box-shadow: 0 12px 36px rgba(253,186,1,0.08); }

    /* mockup modal */
    .mockup{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:flex;align-items:center;justify-content:center;padding:18px;z-index:120;opacity:0;pointer-events:none;transition:opacity .18s}
    .mockup.open{opacity:1;pointer-events:auto}
    .mockup .box{max-width:95%;max-height:85vh;background:rgba(255,255,255,0.02);padding:16px;border-radius:12px;text-align:center;position:relative;overflow:hidden}
    .mockup img{max-width:100%;max-height:70vh;border-radius:8px;display:block;margin:0 auto}
    .mockup .close{position:absolute;top:18px;right:18px;background:transparent;border:0;color:var(--accent);font-size:28px;cursor:pointer}

    .options{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;justify-content:center}
    .option{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);color:var(--accent);cursor:pointer;background:transparent}
    .option.active{background:var(--accent);color:#000}

    /* cursor (album style) */
    .cursor {
      width:28px; height:28px; border-radius:50%;
      position:fixed; pointer-events:none; z-index:9999;
      transform:translate(-50%,-50%) scale(1);
      background:transparent; border:2px solid rgba(253,186,1,0.95);
      box-shadow: 0 0 12px rgba(253,186,1,0.6), 0 0 20px rgba(253,186,1,0.4), inset 0 0 8px rgba(253,186,1,0.08);
      transition: transform .12s cubic-bezier(.2,.9,.2,1), width .12s ease, height .12s ease, opacity .18s ease, box-shadow .18s ease;
      mix-blend-mode: screen;
      opacity:0.98;
      will-change: transform, box-shadow;
    }
    .cursor.small{ transform:translate(-50%,-50%) scale(.6); width:18px; height:18px; border-width:1px; opacity:0.95; box-shadow: 0 0 8px rgba(253,186,1,0.6), 0 0 12px rgba(253,186,1,0.4), inset 0 0 4px rgba(253,186,1,0.08); }
    .cursor.hidden{ opacity:0; }

    @media(max-width:600px){ .album-thumb{height:160px} .search{min-width:140px} .controls{flex-wrap:wrap} .filter-panel{width:100%;} }
    .sr-only{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <div class="bg-layer" aria-hidden="true">
    <div class="orb o1"></div>
    <div class="orb o2"></div>
    <div class="pattern"></div>
    <div class="bokeh" style="left:6%; top:20%; width:46px; height:46px;"></div>
    <div class="bokeh" style="left:22%; top:60%; width:92px; height:92px;"></div>
    <div class="bokeh" style="left:78%; top:34%; width:68px; height:68px;"></div>
    <div class="bokeh" style="left:54%; top:78%; width:120px; height:120px;"></div>
  </div>

  <!-- custom cursor -->
  <div id="cursor" class="cursor" aria-hidden="true"></div>

  <header>
    <div class="brand">
      <img src="ganish studio.png" alt="Ganish Studio">
      <div>
        <h1>Ganish Studio — Thambulam Bags</h1>
        <div class="sub">Traditional · Silk · Customized · Gift Bags</div>
      </div>
    </div>
    <div style="display:flex;gap:12px;align-items:center;">
      <a href="index.html" style="color:var(--muted);text-decoration:none;font-size:14px">← Back</a>
      <button id="openPanel" class="filter-btn" aria-haspopup="dialog" aria-expanded="false">Open Filters</button>
    </div>
  </header>

  <div class="toolbar">
    <div class="filters" role="toolbar" aria-label="Bag categories">
      <button class="filter-btn active" data-cat="all">All</button>
      <button class="filter-btn" data-cat="traditional">Traditional</button>
      <button class="filter-btn" data-cat="silk">Silk</button>
      <button class="filter-btn" data-cat="cotton">Cotton</button>
      <button class="filter-btn" data-cat="jewelry">Jewelry Pouch</button>
      <button class="filter-btn" data-cat="custom">Customized</button>
      <div style="width:8px"></div>

      <div title="Filter by dominant color" style="display:flex;gap:8px;align-items:center;margin-left:6px">
        <button class="filter-btn active" data-color="any">Any</button>
        <button class="filter-btn" data-color="gold" style="background:linear-gradient(90deg,var(--accent),#ffd46a);color:#000">Gold</button>
        <button class="filter-btn" data-color="red" style="background:#ff4d4d;color:#fff">Red</button>
        <button class="filter-btn" data-color="green" style="background:linear-gradient(90deg,#7cc576,#2b8a3e);color:#000">Green</button>
        <button class="filter-btn" data-color="white" style="background:#fff;color:#000">White</button>
      </div>
    </div>

    <div class="controls">
      <input id="search" class="search" placeholder="Search bags — e.g. silk, gold, wedding">
      <select id="sort" class="select" aria-label="Sort by">
        <option value="relevance">Relevance</option>
        <option value="price-asc">Price: Low → High</option>
        <option value="price-desc">Price: High → Low</option>
        <option value="newest">Newest</option>
        <option value="popular">Popular</option>
      </select>
      <div style="display:flex;align-items:center;gap:8px">
        <input id="priceMin" type="number" placeholder="Min ₹" style="width:82px;padding:8px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent)">
        <input id="priceMax" type="number" placeholder="Max ₹" style="width:82px;padding:8px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent)">
      </div>
    </div>
  </div>

  <!-- slide-in filter panel -->
  <div id="panelBackdrop" class="panel-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <aside class="filter-panel" aria-label="Filters">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <h3 style="margin:0;color:var(--accent)">Filters</h3>
        <button id="closePanel" class="panel-close" aria-label="Close filters">Close ✕</button>
      </div>

      <div style="margin-top:12px">
        <div style="font-size:13px;color:var(--muted)">Categories</div>
        <div class="chips" id="panelCats">
          <button class="chip active" data-cat="all">All</button>
          <button class="chip" data-cat="traditional">Traditional</button>
          <button class="chip" data-cat="silk">Silk</button>
          <button class="chip" data-cat="cotton">Cotton</button>
          <button class="chip" data-cat="jewelry">Jewelry Pouch</button>
          <button class="chip" data-cat="custom">Customized</button>
        </div>
      </div>

      <div style="margin-top:14px">
        <div style="font-size:13px;color:var(--muted)">Colors</div>
        <div class="chips" id="panelColors" style="margin-top:8px">
          <button class="chip active" data-color="any">Any</button>
          <button class="chip" data-color="gold">Gold</button>
          <button class="chip" data-color="red">Red</button>
          <button class="chip" data-color="green">Green</button>
          <button class="chip" data-color="white">White</button>
        </div>
      </div>

      <div style="margin-top:14px">
        <div style="font-size:13px;color:var(--muted)">Price</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="panelMin" type="number" placeholder="Min ₹" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent)">
          <input id="panelMax" type="number" placeholder="Max ₹" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,200,0,0.06);background:transparent;color:var(--accent)">
        </div>
      </div>

      <div style="margin-top:18px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="applyPanel" class="panel-close">Apply</button>
        <button id="resetPanel" class="panel-close">Reset</button>
      </div>
    </aside>
  </div>

  <section class="grid" id="grid" aria-live="polite"></section>
  <div id="empty" style="display:none;max-width:1200px;margin:24px auto;color:var(--muted);text-align:center">No bags found.</div>

  <!-- Mockup modal -->
  <div id="mockup" class="mockup" aria-hidden="true" role="dialog" aria-modal="true">
    <button class="close" id="mockClose" aria-label="Close">✕</button>
    <div class="box" id="mockBox">
      <h3 id="mockTitle" style="color:var(--accent)"></h3>
      <img id="mockImg" src="" alt="Bag preview">
      <div class="options" id="mockOptions" aria-label="View options">
        <button class="option active" data-layout="single">Single</button>
        <button class="option" data-layout="spread">Spread</button>
        <button class="option" data-layout="cover">Cover</button>
      </div>
      <div style="margin-top:12px">
        <a id="enquireLink" class="btn" href="mailto:gbeven74@gmail.com?subject=Thambulam%20Bag%20Enquiry">Enquire</a>
        <button id="downloadMock" class="btn">Download</button>
      </div>
    </div>
  </div>

  <script>
    /* ---------- Data (sample thambulam bags) ---------- */
    const bags = [
      {id:1,title:'Royal Silk Thambulam',thumb:'images/bag1.jpg',mock:'images/bag1-large.jpg',category:'silk',desc:'Gold zari silk thambulam bag',price:450,colors:['gold','red'],pop:120,created:'2025-10-01'},
      {id:2,title:'Traditional Red Velvet',thumb:'images/bag2.jpg',mock:'images/bag2-large.jpg',category:'traditional',desc:'Classic red velvet with gold weave',price:350,colors:['red','gold'],pop:95,created:'2025-09-12'},
      {id:3,title:'Green Silk Pouch',thumb:'images/bag3.jpg',mock:'images/bag3-large.jpg',category:'silk',desc:'Emerald green silk with tassels',price:400,colors:['green','gold'],pop:140,created:'2025-08-20'},
      {id:4,title:'Cotton Handloom Bag',thumb:'images/bag4.jpg',mock:'images/bag4-large.jpg',category:'cotton',desc:'Soft cotton handloom bag',price:220,colors:['white','green'],pop:60,created:'2025-07-01'},
      {id:5,title:'Jewelry Pouch Small',thumb:'images/bag5.jpg',mock:'images/bag5-large.jpg',category:'jewelry',desc:'Small pouch for thambil items',price:180,colors:['gold','white'],pop:80,created:'2025-06-15'},
      {id:6,title:'Custom Embroidered',thumb:'images/bag6.jpg',mock:'images/bag6-large.jpg',category:'custom',desc:'Personalized embroidery option',price:600,colors:['gold','red'],pop:55,created:'2025-05-20'},
      {id:7,title:'Gold Brocade Bag',thumb:'images/bag7.jpg',mock:'images/bag7-large.jpg',category:'traditional',desc:'Brocade with gold thread',price:480,colors:['gold'],pop:70,created:'2025-04-12'},
      {id:8,title:'Minimal White Cotton',thumb:'images/bag8.jpg',mock:'images/bag8-large.jpg',category:'cotton',desc:'Minimal white cotton bag',price:200,colors:['white'],pop:45,created:'2025-03-05'},
      {id:9,title:'Festive Red Pack',thumb:'images/bag9.jpg',mock:'images/bag9-large.jpg',category:'traditional',desc:'Festive set of 3 red packs',price:950,colors:['red','gold'],pop:110,created:'2025-02-20'},
      {id:10,title:'Green Silk Deluxe',thumb:'images/bag10.jpg',mock:'images/bag10-large.jpg',category:'silk',desc:'Deluxe silk with zari',price:520,colors:['green','gold'],pop:85,created:'2025-01-18'},
      {id:11,title:'Custom Printed Pouch',thumb:'images/bag11.jpg',mock:'images/bag11-large.jpg',category:'custom',desc:'Printed names or motifs',price:420,colors:['white','gold'],pop:50,created:'2025-06-30'},
      {id:12,title:'Bride Gift Bag',thumb:'images/bag12.jpg',mock:'images/bag12-large.jpg',category:'jewelry',desc:'Special bride gift pouch',price:650,colors:['gold','red'],pop:130,created:'2025-07-22'},
      {id:13,title:'Embroidered Cotton',thumb:'images/bag13.jpg',mock:'images/bag13-large.jpg',category:'cotton',desc:'Hand-embroidered cotton pouch',price:270,colors:['white','green'],pop:40,created:'2025-08-05'},
      {id:14,title:'Platinum Bridal Pouch',thumb:'images/bag14.jpg',mock:'images/bag14-large.jpg',category:'traditional',desc:'Premium bridal pouch with plating',price:1200,colors:['gold','white'],pop:65,created:'2025-09-01'},
      {id:15,title:'Festival Set',thumb:'images/bag15.jpg',mock:'images/bag15-large.jpg',category:'traditional',desc:'Set of assorted festival bags',price:1500,colors:['red','green','gold'],pop:75,created:'2025-10-05'}
    ];

    /* ---------- DOM refs ---------- */
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const mockup = document.getElementById('mockup');
    const mockImg = document.getElementById('mockImg');
    const mockTitle = document.getElementById('mockTitle');
    const mockClose = document.getElementById('mockClose');
    const mockOptions = document.getElementById('mockOptions');
    const enquireLink = document.getElementById('enquireLink');
    const downloadMock = document.getElementById('downloadMock');

    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const priceMin = document.getElementById('priceMin');
    const priceMax = document.getElementById('priceMax');

    /* panel refs */
    const openPanelBtn = document.getElementById('openPanel');
    const panelBackdrop = document.getElementById('panelBackdrop');
    const closePanelBtn = document.getElementById('closePanel');
    const panelCats = document.getElementById('panelCats');
    const panelColors = document.getElementById('panelColors');
    const panelMin = document.getElementById('panelMin');
    const panelMax = document.getElementById('panelMax');
    const applyPanel = document.getElementById('applyPanel');
    const resetPanel = document.getElementById('resetPanel');

    /* cursor */
    const cursor = document.getElementById('cursor');
    let cursorX = window.innerWidth/2, cursorY = window.innerHeight/2;
    let targetX = cursorX, targetY = cursorY;
    let lastMove = Date.now();

    /* ---------- render cards ---------- */
    function render(list){
      grid.innerHTML = '';
      if(!list.length){ empty.style.display='block'; return; } else { empty.style.display='none'; }
      list.forEach(a => {
        const div = document.createElement('div'); div.className='album-card';
        div.innerHTML = `
          <div style="position:relative;overflow:hidden">
            <img class="album-thumb" loading="lazy" src="${a.thumb}" alt="${a.title}">
            <div class="shine" aria-hidden="true"></div>
          </div>
          <div class="album-meta">
            <div style="font-weight:600;color:var(--accent)">${a.title}</div>
            <div style="font-size:13px;color:var(--muted);margin:6px 0">${a.desc}</div>
            <div style="font-size:13px;color:var(--muted);margin-bottom:8px">₹${a.price}</div>
            <div class="meta-row">
              <button class="btn preview" data-id="${a.id}">Preview</button>
              <a class="btn" href="mailto:gbeven74@gmail.com?subject=Thambulam%20Bag%20Enquiry%20-%20${encodeURIComponent(a.title)}">Enquire</a>
            </div>
          </div>
        `;
        attachTilt(div);
        div.querySelector('.preview').addEventListener('click', ()=> openMock(a));
        grid.appendChild(div);
      });
    }
    render(bags);

    /* ---------- filters (toolbar) ---------- */
    const toolbarCatBtns = document.querySelectorAll('.filters .filter-btn[data-cat]');
    const toolbarColorBtns = document.querySelectorAll('.filters .filter-btn[data-color]');

    toolbarCatBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        toolbarCatBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        // sync panel chips
        const cat = btn.dataset.cat;
        document.querySelectorAll('#panelCats .chip').forEach(c=> c.classList.toggle('active', c.dataset.cat === cat));
        applyFilters();
      });
    });

    toolbarColorBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        toolbarColorBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const color = btn.dataset.color;
        document.querySelectorAll('#panelColors .chip').forEach(c=> c.classList.toggle('active', c.dataset.color === color));
        applyFilters();
      });
    });

    // panel chips click behavior
    panelCats.querySelectorAll('.chip').forEach(ch=>{
      ch.addEventListener('click', ()=> {
        panelCats.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        const cat = ch.dataset.cat;
        toolbarCatBtns.forEach(b=> b.classList.toggle('active', b.dataset.cat === cat));
        ch.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 260, easing: 'ease-out' });
      });
    });
    panelColors.querySelectorAll('.chip').forEach(ch=>{
      ch.addEventListener('click', ()=> {
        panelColors.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        toolbarColorBtns.forEach(b=> b.classList.toggle('active', b.dataset.color === ch.dataset.color));
      });
    });

    // controls debounce
    [searchInput, sortSelect, priceMin, priceMax].forEach(el=>{
      el.addEventListener('input', debounce(()=> applyFilters(), 200));
    });

    function getActiveCategory(){
      const btn = document.querySelector('.filters .filter-btn.active[data-cat]');
      return btn ? btn.dataset.cat : 'all';
    }
    function getActiveColor(){
      const btn = document.querySelector('.filters .filter-btn.active[data-color]');
      return btn ? btn.dataset.color : 'any';
    }

    function applyFilters(){
      const cat = getActiveCategory();
      const color = getActiveColor();
      const q = (searchInput.value||'').trim().toLowerCase();
      const sort = sortSelect.value;
      let min = Number(priceMin.value) || 0;
      let max = Number(priceMax.value) || 9999999;
      if(min>max){ const t=min; min=max; max=t; }

      let filtered = bags.filter(a=>{
        if(cat!=='all' && a.category !== cat) return false;
        if(color && color!=='any' && !(a.colors||[]).includes(color)) return false;
        if(a.price < min || a.price > max) return false;
        if(q){
          const t = (a.title + ' ' + a.desc).toLowerCase();
          if(!t.includes(q)) return false;
        }
        return true;
      });

      // sorting
      if(sort==='price-asc') filtered.sort((x,y)=>x.price - y.price);
      else if(sort==='price-desc') filtered.sort((x,y)=>y.price - x.price);
      else if(sort==='newest') filtered.sort((x,y)=> new Date(y.created) - new Date(x.created));
      else if(sort==='popular') filtered.sort((x,y)=> y.pop - x.pop);

      render(filtered);
    }

    /* ---------- panel open/close ---------- */
    openPanelBtn.addEventListener('click', ()=>{
      panelBackdrop.classList.add('open');
      panelBackdrop.setAttribute('aria-hidden','false');
      openPanelBtn.setAttribute('aria-expanded','true');
      // sync panel inputs with toolbar
      const activeCat = getActiveCategory();
      document.querySelectorAll('#panelCats .chip').forEach(c=> c.classList.toggle('active', c.dataset.cat === activeCat));
      const activeColor = getActiveColor();
      document.querySelectorAll('#panelColors .chip').forEach(c=> c.classList.toggle('active', c.dataset.color === activeColor));
      panelMin.value = priceMin.value;
      panelMax.value = priceMax.value;
    });
    closePanelBtn.addEventListener('click', closePanel);
    panelBackdrop.addEventListener('click', (e)=> { if(e.target === panelBackdrop) closePanel(); });
    function closePanel(){
      panelBackdrop.classList.remove('open');
      panelBackdrop.setAttribute('aria-hidden','true');
      openPanelBtn.setAttribute('aria-expanded','false');
    }
    applyPanel.addEventListener('click', ()=>{
      const selectedCat = document.querySelector('#panelCats .chip.active')?.dataset.cat || 'all';
      toolbarCatBtns.forEach(b=> b.classList.toggle('active', b.dataset.cat === selectedCat));
      const selectedColor = document.querySelector('#panelColors .chip.active')?.dataset.color || 'any';
      toolbarColorBtns.forEach(b=> b.classList.toggle('active', b.dataset.color === selectedColor));
      priceMin.value = panelMin.value || '';
      priceMax.value = panelMax.value || '';
      applyFilters();
      closePanel();
    });
    resetPanel.addEventListener('click', ()=>{
      document.querySelectorAll('#panelCats .chip').forEach(c=> c.classList.remove('active'));
      document.querySelector('#panelCats .chip[data-cat="all"]').classList.add('active');
      document.querySelectorAll('#panelColors .chip').forEach(c=> c.classList.remove('active'));
      document.querySelector('#panelColors .chip[data-color="any"]').classList.add('active');
      panelMin.value = '';
      panelMax.value = '';
    });

    /* ---------- mockup modal ---------- */
    function openMock(a){
      mockImg.src = a.mock;
      mockTitle.textContent = a.title;
      enquireLink.href = `mailto:gbeven74@gmail.com?subject=Thambulam%20Bag%20Enquiry%20-%20${encodeURIComponent(a.title)}`;
      mockup.classList.add('open'); mockup.setAttribute('aria-hidden','false');
      mockClose.focus();
      document.querySelectorAll('.option').forEach(o=>o.classList.remove('active'));
      document.querySelector('.option[data-layout="single"]').classList.add('active');
    }
    function closeMock(){ mockup.classList.remove('open'); mockup.setAttribute('aria-hidden','true'); mockImg.src=''; }
    mockClose.addEventListener('click', closeMock);
    mockup.addEventListener('click', (e)=>{ if(e.target===mockup) closeMock(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMock(); });

    mockOptions.addEventListener('click', (e)=>{
      const btn = e.target.closest('.option'); if(!btn) return;
      document.querySelectorAll('.option').forEach(o=>o.classList.remove('active'));
      btn.classList.add('active');
      const layout = btn.dataset.layout;
      const base = mockImg.src.replace(/(-large|-spread|-cover)?(\.jpg|\.png)$/,'');
      const suffix = layout === 'spread' ? '-spread.jpg' : layout === 'cover' ? '-cover.jpg' : '-large.jpg';
      mockImg.src = base + suffix;
    });

    downloadMock.addEventListener('click', ()=>{ if(mockImg.src) window.open(mockImg.src, '_blank'); });

    /* ---------- tilt effect ---------- */
    function attachTilt(el){
      if(!el) return;
      const inner = el;
      let rect = null;
      function onMove(e){
        rect = inner.getBoundingClientRect();
        const px = (e.clientX - rect.left) / rect.width;
        const py = (e.clientY - rect.top) / rect.height;
        const rx = (py - 0.5) * 10;
        const ry = (px - 0.5) * 10;
        inner.style.transform = `perspective(900px) rotateX(${ -rx }deg) rotateY(${ ry }deg) translateZ(0)`;
      }
      function onLeave(){ inner.style.transform=''; }
      inner.addEventListener('mousemove', onMove);
      inner.addEventListener('mouseleave', onLeave);
    }

    /* ---------- custom cursor (lerp follower) ---------- */
    const lerp = (a,b,n) => (1-n)*a + n*b;
    let visible = true;
    window.addEventListener('mousemove', (e)=>{
      targetX = e.clientX; targetY = e.clientY; lastMove = Date.now();
      const t = e.target;
      if(t && (t.tagName==='A' || t.tagName==='BUTTON' || t.closest('.btn') || t.closest('.filter-btn') || t.closest('.chip'))) {
        cursor.classList.add('small');
      } else {
        cursor.classList.remove('small');
      }
      cursor.classList.remove('hidden');
    }, { passive:true });

    function updateCursor(){
      cursorX = lerp(cursorX, targetX, 0.18);
      cursorY = lerp(cursorY, targetY, 0.18);
      cursor.style.transform = `translate3d(${cursorX}px, ${cursorY}px, 0) translate(-50%, -50%)`;
      if(Date.now() - lastMove > 1900) cursor.classList.add('hidden'); else cursor.classList.remove('hidden');
      requestAnimationFrame(updateCursor);
    }
    requestAnimationFrame(updateCursor);

    // keep text inputs with native caret
    document.querySelectorAll('input, textarea, select').forEach(i => { i.addEventListener('mouseenter', ()=> document.documentElement.style.cursor = 'text'); i.addEventListener('mouseleave', ()=> document.documentElement.style.cursor = 'none'); });
    document.documentElement.style.cursor = 'none';

    /* ---------- bokeh randomizer ---------- */
    (function randomizeBokeh(){
      const bokehs = document.querySelectorAll('.bokeh');
      bokehs.forEach((b, i) => {
        const left = Math.random()*92;
        const top = Math.random()*92;
        const size = 30 + Math.random()*140;
        b.style.left = left + '%';
        b.style.top = top + '%';
        b.style.width = size + 'px';
        b.style.height = size + 'px';
        b.style.opacity = (0.06 + Math.random()*0.14).toString();
        b.style.animation = `float ${28 + Math.random()*40}s ease-in-out ${i*0.6}s infinite`;
      });
    })();

    /* ---------- debounce util ---------- */
    function debounce(fn, ms=200){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

    /* ---------- panel-toolbar sync ---------- */
    document.querySelectorAll('.filters .filter-btn[data-cat]').forEach(b=>{
      b.addEventListener('click', ()=> {
        const cat = b.dataset.cat;
        document.querySelectorAll('#panelCats .chip').forEach(c=> c.classList.toggle('active', c.dataset.cat === cat));
      });
    });
    document.querySelectorAll('.filters .filter-btn[data-color]').forEach(b=>{
      b.addEventListener('click', ()=> {
        const color = b.dataset.color;
        document.querySelectorAll('#panelColors .chip').forEach(c=> c.classList.toggle('active', c.dataset.color === color));
      });
    });

    /* ---------- initial apply ---------- */
    applyFilters();

    /* ---------- accessibility: close with Esc ---------- */
    document.addEventListener('keydown', (e)=> {
      if(e.key === 'Escape') {
        if(panelBackdrop.classList.contains('open')) closePanel();
        if(mockup.classList.contains('open')) closeMock();
      }
    });
  </script>
</body>
</html>
